#!/bin/bash
#$ -cwd -R yes -l m_mem_free=100G -l h_rt=72:00:00 -pe smp 4
#$ -o logs/merge_bams.o -e logs/merge_bams.e

#source ~/.bash_profile


##Human
stringtie --merge -G annotation/Rattus_norvegicus.Rnor_6.0.98.gtf -m 200 -F 0.5 -f 0.2 -l STRG_RAT -o annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.gtf rn_lv_006_ctrl_mR_S16_L002_R1_001.fastq.gz/rn_lv_006_ctrl_mR_S16_L002_R1_001_val_1.fq.gz_stringtie.gtf rn_lv_007_ctrl_mR_S17_L002_R1_001.fastq.gz/rn_lv_007_ctrl_mR_S17_L002_R1_001_val_1.fq.gz_stringtie.gtf rn_lv_008_ctrl_mR_S18_L002_R1_001.fastq.gz/rn_lv_008_ctrl_mR_S18_L002_R1_001_val_1.fq.gz_stringtie.gtf rn_lv_009_ctrl_mR_S19_L002_R1_001.fastq.gz/rn_lv_009_ctrl_mR_S19_L002_R1_001_val_1.fq.gz_stringtie.gtf rn_lv_010_ctrl_mR_S20_L002_R1_001.fastq.gz/rn_lv_010_ctrl_mR_S20_L002_R1_001_val_1.fq.gz_stringtie.gtf 1748sTS.Rat.Heart.0dpb.Male.fastq.gz/1748sTS.Rat.Heart.0dpb.Male_trimmed.fq.gz_stringtie.gtf 2435sTS.Rat.Heart.19.Female.fastq.gz/2435sTS.Rat.Heart.19.Female_trimmed.fq.gz_stringtie.gtf 2437sTS.Rat.Heart.19.Female.fastq.gz/2437sTS.Rat.Heart.19.Female_trimmed.fq.gz_stringtie.gtf 2440sTS.Rat.Heart.19.Male.fastq.gz/2440sTS.Rat.Heart.19.Male_trimmed.fq.gz_stringtie.gtf 2667sTS.Rat.Heart.18.Female.fastq.gz/2667sTS.Rat.Heart.18.Female_trimmed.fq.gz_stringtie.gtf 2683sTS.Rat.Heart.20.Female.fastq.gz/2683sTS.Rat.Heart.20.Female_trimmed.fq.gz_stringtie.gtf 2684sTS.Rat.Heart.20.Male.fastq.gz/2684sTS.Rat.Heart.20.Male_trimmed.fq.gz_stringtie.gtf 2685sTS.Rat.Heart.17.Male.fastq.gz/2685sTS.Rat.Heart.17.Male_trimmed.fq.gz_stringtie.gtf 2686sTS.Rat.Heart.17.Female.fastq.gz/2686sTS.Rat.Heart.17.Female_trimmed.fq.gz_stringtie.gtf 2698sTS.Rat.Heart.20.Female.fastq.gz/2698sTS.Rat.Heart.20.Female_trimmed.fq.gz_stringtie.gtf 2702sTS.Rat.Heart.20.Male.fastq.gz/2702sTS.Rat.Heart.20.Male_trimmed.fq.gz_stringtie.gtf 2706sTS.Rat.Heart.0dpb.Female.fastq.gz/2706sTS.Rat.Heart.0dpb.Female_trimmed.fq.gz_stringtie.gtf 2708sTS.Rat.Heart.0dpb.Male.fastq.gz/2708sTS.Rat.Heart.0dpb.Male_trimmed.fq.gz_stringtie.gtf 2710sTS.Rat.Heart.0dpb.Female.fastq.gz/2710sTS.Rat.Heart.0dpb.Female_trimmed.fq.gz_stringtie.gtf 2715sTS.Rat.Heart.19.Male.fastq.gz/2715sTS.Rat.Heart.19.Male_trimmed.fq.gz_stringtie.gtf 2721sTS.Rat.Heart.18.Female.fastq.gz/2721sTS.Rat.Heart.18.Female_trimmed.fq.gz_stringtie.gtf 2723sTS.Rat.Heart.18.Male.fastq.gz/2723sTS.Rat.Heart.18.Male_trimmed.fq.gz_stringtie.gtf 2724sTS.Rat.Heart.1wpb.Female.fastq.gz/2724sTS.Rat.Heart.1wpb.Female_trimmed.fq.gz_stringtie.gtf 2727sTS.Rat.Heart.2wpb.Female.fastq.gz/2727sTS.Rat.Heart.2wpb.Female_trimmed.fq.gz_stringtie.gtf 2728sTS.Rat.Heart.2wpb.Female.fastq.gz/2728sTS.Rat.Heart.2wpb.Female_trimmed.fq.gz_stringtie.gtf 2731sTS.Rat.Heart.2wpb.Male.fastq.gz/2731sTS.Rat.Heart.2wpb.Male_trimmed.fq.gz_stringtie.gtf 2734sTS.Rat.Heart.1wpb.Male.fastq.gz/2734sTS.Rat.Heart.1wpb.Male_trimmed.fq.gz_stringtie.gtf 2736sTS.Rat.Heart.1wpb.Male.fastq.gz/2736sTS.Rat.Heart.1wpb.Male_trimmed.fq.gz_stringtie.gtf 2738sTS.Rat.Heart.6wpb.Female.fastq.gz/2738sTS.Rat.Heart.6wpb.Female_trimmed.fq.gz_stringtie.gtf 2740sTS.Rat.Heart.6wpb.Female.fastq.gz/2740sTS.Rat.Heart.6wpb.Female_trimmed.fq.gz_stringtie.gtf 2742sTS.Rat.Heart.6wpb.Male.fastq.gz/2742sTS.Rat.Heart.6wpb.Male_trimmed.fq.gz_stringtie.gtf 2746sTS.Rat.Heart.16wpb.Female.fastq.gz/2746sTS.Rat.Heart.16wpb.Female_trimmed.fq.gz_stringtie.gtf 2747sTS.Rat.Heart.16wpb.Male.fastq.gz/2747sTS.Rat.Heart.16wpb.Male_trimmed.fq.gz_stringtie.gtf 2749sTS.Rat.Heart.16wpb.Male.fastq.gz/2749sTS.Rat.Heart.16wpb.Male_trimmed.fq.gz_stringtie.gtf 2751sTS.Rat.Heart.6wpb.Male.fastq.gz/2751sTS.Rat.Heart.6wpb.Male_trimmed.fq.gz_stringtie.gtf 2760sTS.Rat.Heart.2wpb.Male.fastq.gz/2760sTS.Rat.Heart.2wpb.Male_trimmed.fq.gz_stringtie.gtf 2762sTS.Rat.Heart.18.Male.fastq.gz/2762sTS.Rat.Heart.18.Male_trimmed.fq.gz_stringtie.gtf 2853sTS.Rat.Heart.16wpb.Female.fastq.gz/2853sTS.Rat.Heart.16wpb.Female_trimmed.fq.gz_stringtie.gtf 3514sTS.Rat.Heart.13.Female.fastq.gz/3514sTS.Rat.Heart.13.Female_trimmed.fq.gz_stringtie.gtf 3521sTS.Rat.Heart.13.Male.fastq.gz/3521sTS.Rat.Heart.13.Male_trimmed.fq.gz_stringtie.gtf 3528sTS.Rat.Heart.13.Female.fastq.gz/3528sTS.Rat.Heart.13.Female_trimmed.fq.gz_stringtie.gtf 3539sTS.Rat.Heart.14.Female.fastq.gz/3539sTS.Rat.Heart.14.Female_trimmed.fq.gz_stringtie.gtf 3548sTS.Rat.Heart.14.Female.fastq.gz/3548sTS.Rat.Heart.14.Female_trimmed.fq.gz_stringtie.gtf 3552sTS.Rat.Heart.14.Male.fastq.gz/3552sTS.Rat.Heart.14.Male_trimmed.fq.gz_stringtie.gtf 3556sTS.Rat.Heart.14.Male.fastq.gz/3556sTS.Rat.Heart.14.Male_trimmed.fq.gz_stringtie.gtf 3560sTS.Rat.Heart.15.Male.fastq.gz/3560sTS.Rat.Heart.15.Male_trimmed.fq.gz_stringtie.gtf 3562sTS.Rat.Heart.15.Female.fastq.gz/3562sTS.Rat.Heart.15.Female_trimmed.fq.gz_stringtie.gtf 3565sTS.Rat.Heart.15.Male.fastq.gz/3565sTS.Rat.Heart.15.Male_trimmed.fq.gz_stringtie.gtf 3570sTS.Rat.Heart.15.Female.fastq.gz/3570sTS.Rat.Heart.15.Female_trimmed.fq.gz_stringtie.gtf 3595sTS.Rat.Heart.16.Female.fastq.gz/3595sTS.Rat.Heart.16.Female_trimmed.fq.gz_stringtie.gtf 3600sTS.Rat.Heart.16.Male.fastq.gz/3600sTS.Rat.Heart.16.Male_trimmed.fq.gz_stringtie.gtf 3604sTS.Rat.Heart.16.Female.fastq.gz/3604sTS.Rat.Heart.16.Female_trimmed.fq.gz_stringtie.gtf 3607sTS.Rat.Heart.16.Female.fastq.gz/3607sTS.Rat.Heart.16.Female_trimmed.fq.gz_stringtie.gtf 3650sTS.Rat.Heart.13.Male.fastq.gz/3650sTS.Rat.Heart.13.Male_trimmed.fq.gz_stringtie.gtf 3900sTS.Rat.Heart.17.Female.fastq.gz/3900sTS.Rat.Heart.17.Female_trimmed.fq.gz_stringtie.gtf 3902sTS.Rat.Heart.17.Male.fastq.gz/3902sTS.Rat.Heart.17.Male_trimmed.fq.gz_stringtie.gtf 4194sTS.Rat.Heart.12.Male.fastq.gz/4194sTS.Rat.Heart.12.Male_trimmed.fq.gz_stringtie.gtf 4196sTS.Rat.Heart.12.Male.fastq.gz/4196sTS.Rat.Heart.12.Male_trimmed.fq.gz_stringtie.gtf 4201sTS.Rat.Heart.12.Female.fastq.gz/4201sTS.Rat.Heart.12.Female_trimmed.fq.gz_stringtie.gtf 4259sTS.Rat.Heart.12.Female.fastq.gz/4259sTS.Rat.Heart.12.Female_trimmed.fq.gz_stringtie.gtf 4323sTS.Rat.Heart.11.Female.fastq.gz/4323sTS.Rat.Heart.11.Female_trimmed.fq.gz_stringtie.gtf 4325sTS.Rat.Heart.11.Female.fastq.gz/4325sTS.Rat.Heart.11.Female_trimmed.fq.gz_stringtie.gtf 4327sTS.Rat.Heart.11.Male.fastq.gz/4327sTS.Rat.Heart.11.Male_trimmed.fq.gz_stringtie.gtf 4329sTS.Rat.Heart.11.Male.fastq.gz/4329sTS.Rat.Heart.11.Male_trimmed.fq.gz_stringtie.gtf 4900sTS.Rat.Heart.3dpb.Female.fastq.gz/4900sTS.Rat.Heart.3dpb.Female_trimmed.fq.gz_stringtie.gtf 4906sTS.Rat.Heart.3dpb.Male.fastq.gz/4906sTS.Rat.Heart.3dpb.Male_trimmed.fq.gz_stringtie.gtf 4960sTS.Rat.Heart.3dpb.Male.fastq.gz/4960sTS.Rat.Heart.3dpb.Male_trimmed.fq.gz_stringtie.gtf 4966sTS.Rat.Heart.3dpb.Female.fastq.gz/4966sTS.Rat.Heart.3dpb.Female_trimmed.fq.gz_stringtie.gtf 5576sTS.Rat.Heart.18.Female.fastq.gz/5576sTS.Rat.Heart.18.Female_trimmed.fq.gz_stringtie.gtf 5577sTS.Rat.Heart.18.Female.fastq.gz/5577sTS.Rat.Heart.18.Female_trimmed.fq.gz_stringtie.gtf

gffcompare -R -r annotation/Rattus_norvegicus.Rnor_6.0.98.gtf annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.gtf -o annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.gtf.cuffcomp

python3 ensemblarize_gtf.py annotation/Rattus_norvegicus.Rnor_6.0.98.gtf annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.gtf.cuffcomp.annotated.gtf | sort -k1,1 -k4,4n -k5,5n > annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.fixed.gtf

mkdir annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.stringtie2021.fixed

STAR --runThreadN 4 \
--runMode genomeGenerate \
--limitGenomeGenerateRAM=141278166400 \
--genomeDir annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.stringtie2021.fixed  \
--genomeFastaFiles annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.fa \
--sjdbGTFfile annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.fixed.gtf \
--sjdbOverhang 75

gffread annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.fixed.gtf -g annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.fa -w annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.stringtie2021.fixed.fa
gffread annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.fixed.gtf -g annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.fa -x annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.stringtie2021.fixed.CDS.fa
python3 translate_orfs.py annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.stringtie2021.fixed.CDS.fa > annotation/Rattus_norvegicus.Rnor_6.0.dna.toplevel.stringtie2021.fixed.prot.fa

sort -k1,1 -k4,4n -k5,5n annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.fixed.gtf > annotation/Rattus_norvegicus.Rnor_6.0.98.stringtie2021.fixed.sorted.gtf
